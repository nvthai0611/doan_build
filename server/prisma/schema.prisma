//
// Autogenerated by `prisma-import`
// Any modifications will be overwritten on subsequent runs.
//

//
// _base.prisma
//

// _base.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//
// check.prisma
//

//
// courses.prisma
//

// post.prisma

// ========== CORE ==========

model User {
  id        String   @id @default(uuid()) @db.Uuid
  username  String   @unique
  email     String   @unique
  password  String   @map("password")
  fullName  String?  @map("full_name")
  phone     String?
  role      String // admin, owner, teacher, parent, student, staff
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  teacher              Teacher?
  student              Student?
  parent               Parent?
  centerUsers          CenterUser[]
  sentMessages         Message[]      @relation("SentMessages")
  receivedMessages     Message[]      @relation("ReceivedMessages")
  recordedAttendances  Attendance[]   @relation("RecordedBy")
  gradedAssessments    Grade[]        @relation("GradedBy")
  uploadedMaterials    Material[]     @relation("UploadedBy")
  createdNotifications Notification[] @relation("CreatedBy")

  @@map("users")
}

model Teacher {
  id          String    @id @default(uuid()) @db.Uuid
  userId      String    @unique @map("user_id") @db.Uuid
  centerId    String    @map("center_id") @db.Uuid
  hireDate    DateTime? @map("hire_date") @db.Date
  contractEnd DateTime? @map("contract_end") @db.Date
  subjects    String[]
  salary      Decimal?  @db.Decimal(12, 2)
  createdAt   DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt   DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  user      User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  center    Center            @relation(fields: [centerId], references: [id])
  classes   Class[]
  documents TeacherDocument[]
  contracts Contract[]
  payrolls  Payroll[]

  @@map("teachers")
}

model Student {
  id          String    @id @default(uuid()) @db.Uuid
  userId      String    @unique @map("user_id") @db.Uuid
  centerId    String    @map("center_id") @db.Uuid
  studentCode String?   @unique @map("student_code")
  dateOfBirth DateTime? @map("date_of_birth") @db.Date
  gender      String?
  address     String?
  createdAt   DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt   DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  user        User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  center      Center              @relation(fields: [centerId], references: [id])
  parentLinks StudentParentLink[]
  enrollments Enrollment[]
  attendances Attendance[]
  grades      Grade[]

  @@map("students")
}

model Parent {
  id        String   @id @default(uuid()) @db.Uuid
  userId    String   @unique @map("user_id") @db.Uuid
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  // Relations
  user         User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  studentLinks StudentParentLink[]

  @@map("parents")
}

model StudentParentLink {
  id             BigInt  @id @default(autoincrement()) @db.BigInt
  studentId      String  @map("student_id") @db.Uuid
  parentId       String  @map("parent_id") @db.Uuid
  relation       String?
  primaryContact Boolean @default(false) @map("primary_contact")

  // Relations
  student Student @relation(fields: [studentId], references: [id], onDelete: Cascade)
  parent  Parent  @relation(fields: [parentId], references: [id], onDelete: Cascade)

  @@map("student_parent_links")
}

// ========== ORGANIZATION ==========

model Center {
  id           String   @id @default(uuid()) @db.Uuid
  name         String?
  address      String?
  contactEmail String?  @map("contact_email")
  contactPhone String?  @map("contact_phone")
  timezone     String?
  createdAt    DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt    DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  centerUsers   CenterUser[]
  teachers      Teacher[]
  students      Student[]
  courses       Course[]
  rooms         Room[]
  notifications Notification[]
  alerts        Alert[]

  @@map("centers")
}

model CenterUser {
  id        BigInt   @id @default(autoincrement()) @db.BigInt
  centerId  String   @map("center_id") @db.Uuid
  userId    String   @map("user_id") @db.Uuid
  role      String? // owner, manager, staff
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  // Relations
  center Center @relation(fields: [centerId], references: [id], onDelete: Cascade)
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("center_users")
}

// ========== COURSES & CLASSES ==========

model Subject {
  id          String  @id @default(uuid()) @db.Uuid
  code        String  @unique
  name        String?
  description String?

  // Relations
  courses Course[]

  @@map("subjects")
}

model Course {
  id          String   @id @default(uuid()) @db.Uuid
  centerId    String   @map("center_id") @db.Uuid
  name        String?
  subjectId   String   @map("subject_id") @db.Uuid
  maxStudents Int?     @map("max_students") @db.Integer
  status      String   @default("draft")
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt   DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  center  Center  @relation(fields: [centerId], references: [id])
  subject Subject @relation(fields: [subjectId], references: [id])
  classes Class[]

  @@map("courses")
}

model Class {
  id                String    @id @default(uuid()) @db.Uuid
  courseId          String    @map("course_id") @db.Uuid
  teacherId         String    @map("teacher_id") @db.Uuid
  roomId            String?   @map("room_id") @db.Uuid
  startDate         DateTime? @map("start_date") @db.Date
  endDate           DateTime? @map("end_date") @db.Date
  recurringSchedule Json?     @map("recurring_schedule") @db.JsonB
  createdAt         DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt         DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  course      Course         @relation(fields: [courseId], references: [id])
  teacher     Teacher        @relation(fields: [teacherId], references: [id])
  room        Room?          @relation(fields: [roomId], references: [id])
  sessions    ClassSession[]
  enrollments Enrollment[]
  assessments Assessment[]
  materials   Material[]

  @@map("classes")
}

model ClassSession {
  id          String   @id @default(uuid()) @db.Uuid
  classId     String   @map("class_id") @db.Uuid
  sessionDate DateTime @map("session_date") @db.Date
  startTime   DateTime @map("start_time") @db.Time
  endTime     DateTime @map("end_time") @db.Time
  roomId      String?  @map("room_id") @db.Uuid
  status      String   @default("scheduled")
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz

  // Relations
  class       Class        @relation(fields: [classId], references: [id], onDelete: Cascade)
  room        Room?        @relation(fields: [roomId], references: [id])
  attendances Attendance[]

  @@map("class_sessions")
}

model Enrollment {
  id         BigInt   @id @default(autoincrement()) @db.BigInt
  studentId  String   @map("student_id") @db.Uuid
  classId    String   @map("class_id") @db.Uuid
  enrolledAt DateTime @default(now()) @map("enrolled_at") @db.Timestamptz
  status     String   @default("active")

  // Relations
  student Student @relation(fields: [studentId], references: [id], onDelete: Cascade)
  class   Class   @relation(fields: [classId], references: [id], onDelete: Cascade)

  @@map("enrollments")
}

model Room {
  id        String   @id @default(uuid()) @db.Uuid
  centerId  String   @map("center_id") @db.Uuid
  name      String?
  capacity  Int?     @db.Integer
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  // Relations
  center   Center         @relation(fields: [centerId], references: [id])
  classes  Class[]
  sessions ClassSession[]

  @@map("rooms")
}

// ========== ATTENDANCE & GRADES ==========

model Attendance {
  id         BigInt   @id @default(autoincrement()) @db.BigInt
  sessionId  String   @map("session_id") @db.Uuid
  studentId  String   @map("student_id") @db.Uuid
  status     String // present, absent, late, excused
  note       String?
  recordedBy String   @map("recorded_by") @db.Uuid
  recordedAt DateTime @default(now()) @map("recorded_at") @db.Timestamptz

  // Relations
  session        ClassSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  student        Student      @relation(fields: [studentId], references: [id], onDelete: Cascade)
  recordedByUser User         @relation("RecordedBy", fields: [recordedBy], references: [id])

  @@map("attendances")
}

model Assessment {
  id        String    @id @default(uuid()) @db.Uuid
  classId   String    @map("class_id") @db.Uuid
  name      String?
  type      String? // quiz, midterm, final, assignment
  maxScore  Decimal?  @map("max_score")
  date      DateTime? @db.Timestamptz
  createdAt DateTime  @default(now()) @map("created_at") @db.Timestamptz

  // Relations
  class  Class   @relation(fields: [classId], references: [id], onDelete: Cascade)
  grades Grade[]

  @@map("assessments")
}

model Grade {
  id           BigInt   @id @default(autoincrement()) @db.BigInt
  assessmentId String   @map("assessment_id") @db.Uuid
  studentId    String   @map("student_id") @db.Uuid
  score        Decimal?
  feedback     String?
  gradedBy     String   @map("graded_by") @db.Uuid
  gradedAt     DateTime @default(now()) @map("graded_at") @db.Timestamptz

  // Relations
  assessment   Assessment @relation(fields: [assessmentId], references: [id], onDelete: Cascade)
  student      Student    @relation(fields: [studentId], references: [id], onDelete: Cascade)
  gradedByUser User       @relation("GradedBy", fields: [gradedBy], references: [id])

  @@map("grades")
}

// ========== MATERIALS & COMMUNICATION ==========

model Material {
  id         BigInt   @id @default(autoincrement()) @db.BigInt
  classId    String   @map("class_id") @db.Uuid
  title      String?
  url        String?
  uploadedBy String   @map("uploaded_by") @db.Uuid
  uploadedAt DateTime @default(now()) @map("uploaded_at") @db.Timestamptz

  // Relations
  class          Class @relation(fields: [classId], references: [id], onDelete: Cascade)
  uploadedByUser User  @relation("UploadedBy", fields: [uploadedBy], references: [id])

  @@map("materials")
}

model Message {
  id         BigInt    @id @default(autoincrement()) @db.BigInt
  senderId   String    @map("sender_id") @db.Uuid
  receiverId String    @map("receiver_id") @db.Uuid
  subject    String?
  body       String?
  readAt     DateTime? @map("read_at") @db.Timestamptz
  createdAt  DateTime  @default(now()) @map("created_at") @db.Timestamptz

  // Relations
  sender   User @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)
  receiver User @relation("ReceivedMessages", fields: [receiverId], references: [id], onDelete: Cascade)

  @@map("messages")
}

model Notification {
  id        BigInt    @id @default(autoincrement()) @db.BigInt
  centerId  String    @map("center_id") @db.Uuid
  title     String?
  body      String?
  audience  Json?     @db.JsonB
  sentAt    DateTime? @map("sent_at") @db.Timestamptz
  createdBy String    @map("created_by") @db.Uuid
  createdAt DateTime  @default(now()) @map("created_at") @db.Timestamptz

  // Relations
  center        Center @relation(fields: [centerId], references: [id])
  createdByUser User   @relation("CreatedBy", fields: [createdBy], references: [id])

  @@map("notifications")
}

model Alert {
  id          BigInt   @id @default(autoincrement()) @db.BigInt
  centerId    String   @map("center_id") @db.Uuid
  alertType   String   @map("alert_type")
  payload     Json?    @db.JsonB
  triggeredAt DateTime @default(now()) @map("triggered_at") @db.Timestamptz
  processed   Boolean  @default(false)

  // Relations
  center Center @relation(fields: [centerId], references: [id])

  @@map("alerts")
}

// ========== HR / CONTRACTS ==========

model TeacherDocument {
  id         BigInt   @id @default(autoincrement()) @db.BigInt
  teacherId  String   @map("teacher_id") @db.Uuid
  docType    String?  @map("doc_type")
  docUrl     String?  @map("doc_url")
  uploadedAt DateTime @default(now()) @map("uploaded_at") @db.Timestamptz

  // Relations
  teacher Teacher @relation(fields: [teacherId], references: [id], onDelete: Cascade)

  @@map("teacher_documents")
}

model Contract {
  id        BigInt    @id @default(autoincrement()) @db.BigInt
  teacherId String    @map("teacher_id") @db.Uuid
  startDate DateTime? @map("start_date") @db.Date
  endDate   DateTime? @map("end_date") @db.Date
  salary    Decimal?  @db.Decimal(12, 2)
  terms     Json?     @db.JsonB
  createdAt DateTime  @default(now()) @map("created_at") @db.Timestamptz

  // Relations
  teacher Teacher @relation(fields: [teacherId], references: [id], onDelete: Cascade)

  @@map("contracts")
}

model Payroll {
  id              BigInt    @id @default(autoincrement()) @db.BigInt
  teacherId       String    @map("teacher_id") @db.Uuid
  periodStart     DateTime  @map("period_start") @db.Date
  periodEnd       DateTime  @map("period_end") @db.Date
  amount          Decimal   @db.Decimal(12, 2)
  computedDetails Json?     @map("computed_details") @db.JsonB
  paidAt          DateTime? @map("paid_at") @db.Timestamptz

  // Relations
  teacher Teacher @relation(fields: [teacherId], references: [id], onDelete: Cascade)

  @@map("payrolls")
}
