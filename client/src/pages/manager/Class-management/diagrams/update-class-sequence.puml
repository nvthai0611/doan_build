@startuml Update Class

title Update Class

actor "Manager" as Manager
boundary "EditClass" as UI
control "ClassService" as Service
control "ClassController" as Controller
control "ClassService" as BackendService
database "Database" as DB

Manager -> UI: Navigate to edit class
activate UI
UI -> Service: Load class data & reference data
activate Service
Service -> Controller: GET /admin-center/classes/{id}
activate Controller
Controller -> BackendService: findOne(id)
activate BackendService
BackendService -> DB: prisma.class.findUnique()
activate DB
DB --> BackendService: class data
deactivate DB
BackendService --> Controller: class response
deactivate BackendService
Controller --> Service: class data
deactivate Controller
Service --> UI: class data
deactivate Service
UI --> Manager: display form with current data
deactivate UI

alt Load reference data
UI -> Service: Load subjects, rooms, grades, teachers
activate Service
Service -> Controller: GET /subjects, /rooms, /grades, /teachers
activate Controller
Controller -> BackendService: findAll()
activate BackendService
BackendService -> DB: prisma.findMany()
activate DB
DB --> BackendService: reference data
deactivate DB
BackendService --> Controller: API response
deactivate BackendService
Controller --> Service: reference data
deactivate Controller
Service --> UI: reference data
deactivate Service
UI --> Manager: populate form options
deactivate UI
end

alt Submit updated form
Manager -> UI: Submit form
activate UI
UI -> UI: Validate form data
alt Validation fails
UI --> Manager: show validation errors
else Validation passes
UI -> Service: updateClass(id, formData)
activate Service
Service -> Controller: PATCH /admin-center/classes/{id}
activate Controller
Controller -> BackendService: update(id, updateClassDto)
activate BackendService
BackendService -> DB: prisma.class.update()
activate DB
DB --> BackendService: updated class
deactivate DB
BackendService --> Controller: success response
deactivate BackendService
Controller --> Service: API response
deactivate Controller
Service --> UI: success
deactivate Service
UI --> Manager: show success toast & redirect
deactivate UI
end
end

@enduml
